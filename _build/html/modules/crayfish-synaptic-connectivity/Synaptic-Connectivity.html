
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Synaptic Connectivity &#8212; Neurophysiology Lab</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/NeuronImage_CourseHeader.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Neurophysiology Lab</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to Neurophysiology Lab
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  General
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standards.html">
   Standards
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../howto/howto.html">
   How To Guides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Python-Introduction-Coding-Light.html">
     Introduction to Python Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Executable-Notebooks.html">
     Executable Notebooks (Data Explorers)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Response-Notebooks.html">
     Response Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/NiUSB-6211.html">
     Nidaq USB 6211
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../materials.html">
   Materials
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Chapters
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../passive-membrane-models/passive-membrane-models_landing.html">
   Week 1. Introduction to Passive Physiology Principles
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../passive-membrane-models/Lab-Manual_passive-membrane-models.html">
     Lab Manual and Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../passive-membrane-models/Responses_passive-membrane-models.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eod/eod_landing.html">
   Week 2. Electric Organ Discharge
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod/Lab-Manual_eod.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod/Data-Explorer_eod.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod/Responses_eod.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eod-stim/eod-stim_landing.html">
   Week 3. Experimental Design for Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod-stim/Lab-Manual_eod-stim.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod-stim/Data-Explorer_eod-stim.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod-stim/Responses_eod-stim.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../earthworm-giant-fiber/earthworm-giant-fiber_landing.html">
   Week 4. Giant Fiber
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../earthworm-giant-fiber/Lab-Manual_earthworm-giant-fiber.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../earthworm-giant-fiber/Data-Explorer_earthworm-giant-fiber.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../earthworm-giant-fiber/Responses_earthworm-giant-fiber.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../computer-model/computer-model_landing.html">
   Week 5. Computer Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../computer-model/Lab-Manual_computer-model.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../computer-model/Data-Explorer_computer-model.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../computer-model/Responses_computer-model.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cockroach-mechanoreceptor/cockroach-mechanoreceptor_landing.html">
   Week 5. Mechanoreceptors
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cockroach-mechanoreceptor/Lab-Manual_cockroach-mechanoreceptor.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cockroach-mechanoreceptor/Data-Explorer_cockroach-mechanoreceptor.html">
     Sensory Coding: Cockroach mechanoreceptors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cockroach-mechanoreceptor/Responses_cockroach-mechanoreceptor.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-mro/crayfish-mro_landing.html">
   Week 6. Muscle Receptor Organ
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-mro/Lab-Manual_crayfish-mro.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-mro/Data-Explorer_crayfish-mro.html">
     Sensory Coding - MROs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-mro/Responses_crayfish-mro.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-erg/crayfish-erg_landing.html">
   Week 7. ElectroRetinoGram
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-erg/Lab-Manual_crayfish-erg.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-erg/Data-Explorer_crayfish-erg.html">
     Sensory Coding - ERG
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-erg/Responses_crayfish-erg.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-n3/crayfish-n3_landing.html">
   Week 8. Crayfish Motor Nerve 3
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-n3/Lab-Manual_crayfish-n3.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-n3/Data-Explorer_crayfish-n3.html">
     Motor Neuron Coding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-n3/Responses_crayfish-n3.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-superficial-flexor/crayfish-superficial-flexor_landing.html">
   Week 9. Crayfish Superficial Flexor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-superficial-flexor/Lab-Manual_crayfish-superficial-flexor.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-superficial-flexor/Data-Explorer_crayfish-superficial-flexor.html">
     Arthropod skeletal muscle compared to vertebrate skeletal muscle:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-superficial-flexor/Responses_crayfish-superficial-flexor.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="crayfish-synaptic-connectivity_landing.html">
   Week 10. Synaptic Connectivity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Lab-Manual_crayfish-synaptic-connectivity.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Data-Explorer_crayfish-synaptic-connectivity.html">
     Arthropod skeletal muscle compared to vertebrate skeletal muscle:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Responses_crayfish-synaptic-connectivity.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-cpg/crayfish-cpg_landing.html">
   Week 11. Neural Circuits
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-cpg/Lab-Manual_crayfish-cpg.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-cpg/Data-Explorer_crayfish-cpg.html">
     Neural Circuits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-cpg/Responses_crayfish-cpg.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../human-emg/human-emg_landing.html">
   Week 12. Human Motor Neurons
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg/Lab-Manual_human-emg.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg/Data-Explorer_human-emg.html">
     Human Motor Neuron Coding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg/Responses_human-emg.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../human-emg-video-big-data/human-emg-video-big-data_landing.html">
   Week 13. Motor Coordination and Big Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg-video-big-data/Lab-Manual_human-emg-video-big-data.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg-video-big-data/Data-Explorer_human-emg-video-big-data.html">
     Motor Coordination and Big Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg-video-big-data/Responses_human-emg-video-big-data.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wrapping Up
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../closure/closure.html">
   Closure
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Extensions of this Material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../extensions/extensions.html">
   Extensions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/modules/crayfish-synaptic-connectivity/Synaptic-Connectivity.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/neurologic/Neurophysiology-Lab"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/neurologic/Neurophysiology-Lab/issues/new?title=Issue%20on%20page%20%2Fmodules/crayfish-synaptic-connectivity/Synaptic-Connectivity.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/neurologic/Neurophysiology-Lab/main?urlpath=tree/modules/crayfish-synaptic-connectivity/Synaptic-Connectivity.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/neurologic/Neurophysiology-Lab/blob/main/modules/crayfish-synaptic-connectivity/Synaptic-Connectivity.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Synaptic Connectivity
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-i-process-data">
   Part I. Process Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-ii-spike-triggered-voltage">
   Part II. Spike-triggered voltage
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-iii-psp-amplitudes">
   Part III. PSP amplitudes
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Synaptic Connectivity</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Synaptic Connectivity
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-i-process-data">
   Part I. Process Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-ii-spike-triggered-voltage">
   Part II. Spike-triggered voltage
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-iii-psp-amplitudes">
   Part III. PSP amplitudes
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a href="https://colab.research.google.com/github/neurologic/Neurophysiology-Lab/blob/main/week-8/Synaptic-Connectivity.ipynb" target="_blank" rel="noopener noreferrer"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"/></a></p>
<p><a id="intro"></a></p>
<div class="tex2jax_ignore mathjax_ignore section" id="synaptic-connectivity">
<h1>Synaptic Connectivity<a class="headerlink" href="#synaptic-connectivity" title="Permalink to this headline">¶</a></h1>
<p>Arthropod muscle innervation is different from vertebrate muscle innervation in several interesting ways:</p>
<ul>
    <li>Arthropod muscles are innervated by relatively few excitatory motor neurons (sometimes only one).</li>
    <li>Arthropod motor neurons innervate each muscle fiber at multiple points (multiterminal innervation).</li>
    <li>More than one motor neuron may innervate one muscle fiber (polyneuronal innervation).</li>
    <li>Inhibitory motor neurons may innervate muscle fibers (and sometimes the terminals of the excitatory motor nerve endings).
    <li>The tonic superficial flexor does not have “all-or-none” propagated action potentials, but instead has graded electrical responses dependent upon the level of the excitation and inhibition. The degree of depolarization determines the amount of Ca2+ that enters the cell through voltage-gated channels; the amount of Ca2+ entry in turn determines the strength of muscle contraction. Note: unlike the superficial flexor, fast phasic crayfish muscles may fire Ca2+-based action potentials.</li>
    </ul>
<img src='https://github.com/neurologic/Neurophysiology-Lab/blob/main/images/fig.A.3-Comparison_with_Skeletal_Muscle.png?raw=True' width="600" alt='arthoropod versus vertebrate muscle innervation' align="center"/>
<p>Therefore, arthropod skeletal muscle integration (innervation and summation) is actually more analagous to cortical dendritic integration in vertebrates. As in human brains, glutamate is an excitatory transmitter and GABA is an inhibitory transmitter. The multiterminal, polyneuronal, and inhibitory innervation of crustacean muscle, the use of glutamate and GABA as transmitters, and the extensive synaptic plasticity make the crayfish neuromuscular junction a good simplified model for the complex mix of synaptic interactions that occur in our own brains.</p>
<img src='https://github.com/neurologic/Neurophysiology-Lab/blob/main/images/fig.A.4-Comparison_with_Brain_Synapses.png?raw=True' width="600" alt='arthoropod versus vertebrate muscle innervation' align="center"/>
<p><a id="toc"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="#intro">Introduction</a></p></li>
<li><p><a class="reference external" href="#setup">Setup</a></p></li>
<li><p><a class="reference external" href="#one">Part I. Process Data</a></p></li>
<li><p><a class="reference external" href="#two">Part II. Spike-Triggered Voltage</a></p></li>
<li><p><a class="reference external" href="#three">Part III. PSP amplitudes</a></p></li>
</ul>
<p><a id="setup"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<p>Import and define functions</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode: &quot;form&quot;}</span>

<span class="c1">#@markdown Run this code cell to import packages and define functions </span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">hilbert</span><span class="p">,</span><span class="n">medfilt</span><span class="p">,</span><span class="n">resample</span><span class="p">,</span> <span class="n">find_peaks</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">timezone</span><span class="p">,</span><span class="n">timedelta</span>
<span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">n_colors</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">pal</span> <span class="o">=</span> <span class="n">pal</span><span class="o">.</span><span class="n">as_hex</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">widgets</span><span class="p">,</span> <span class="n">interact</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p>Mount Google Drive</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode: &quot;form&quot;}</span>

<span class="c1">#@markdown Run this cell to mount your Google Drive.</span>

<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p>Import data digitized with <em>Nidaq USB6211</em> and recorded using <em>Bonsai-rx</em> as a <em>.bin</em> file</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode: &quot;form&quot;}</span>

<span class="c1">#@markdown Specify the file path </span>
<span class="c1">#@markdown to your recorded data on Drive (find the filepath in the colab file manager:</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;full filepath goes here&quot;</span>  <span class="c1">#@param </span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;/Users/kperks/mnt/OneDrive - wesleyan.edu/Teaching/Neurophysiology_FA21/Data/CrayfishNerve3/nerve_Muscle_TelsonStim2021-07-16T14_34_57.bin&#39;</span>

<span class="c1">#@markdown Specify the sampling rate and number of channels recorded.</span>

<span class="n">sampling_rate</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>
<span class="n">number_channels</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>
<span class="n">muscle_channel</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>
<span class="n">nerve_channel</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>

<span class="n">downsample</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#@param</span>
<span class="n">newfs</span> <span class="o">=</span> <span class="mi">2500</span> <span class="c1">#@param</span>

<span class="c1">#@markdown After you have filled out all form fields, </span>
<span class="c1">#@markdown run this code cell to load the data. </span>

<span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

<span class="c1"># No need to edit below this line</span>
<span class="c1">#################################</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="k">if</span> <span class="n">number_channels</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">number_channels</span><span class="p">)</span>
<span class="n">dur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">sampling_rate</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;duration of recording was </span><span class="si">%0.2f</span><span class="s1"> seconds&#39;</span> <span class="o">%</span><span class="k">dur</span>)

<span class="n">fs</span> <span class="o">=</span> <span class="n">sampling_rate</span>
<span class="k">if</span> <span class="n">downsample</span><span class="p">:</span>
    <span class="c1"># newfs = 2500 #downsample data</span>
    <span class="n">chunksize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampling_rate</span><span class="o">/</span><span class="n">newfs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">number_channels</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">chunksize</span><span class="p">,:]</span>
    <span class="k">if</span> <span class="n">number_channels</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">chunksize</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dur</span><span class="p">)</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dur</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pre</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">nerve_channel</span><span class="p">]</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">muscle_channel</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Now be a bit patient while it plots.&#39;</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shared_xaxes</span><span class="o">=</span> <span class="kc">True</span><span class="p">))</span> <span class="c1">#,layout=go.Layout(height=500, width=800))</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pre synaptic&#39;</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;post synaptic&#39;</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">xaxis2_title</span><span class="o">=</span><span class="s2">&quot;time(seconds)&quot;</span><span class="p">,</span> 
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;pre-synaptic voltage&#39;</span><span class="p">,</span> <span class="n">yaxis2_title</span><span class="o">=</span><span class="s1">&#39;post-synaptic voltage&#39;</span><span class="p">)</span>

<span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">step</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">slider</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;600px&#39;</span>

<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">starti</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">stopi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">post</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>

<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">slider</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
<p><a id="one"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part-i-process-data">
<h1>Part I. Process Data<a class="headerlink" href="#part-i-process-data" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown Type in the start and stop time (in seconds) </span>
<span class="c1">#@markdown that specifies the section of your recording you want to focus on for analysis.</span>
<span class="n">start_time</span> <span class="o">=</span>   <span class="kc">None</span> <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="n">stop_time</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="c1">#@markdown Also type in an appropriate threshold amplitude for event detection.</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="c1">#@markdown Then from the dropdown, select a polarity (whether peaks are up or down)</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="s2">&quot;select peak direction&quot;</span>  <span class="c1">#@param [&#39;select peak direction&#39;,&#39;up&#39;, &#39;down&#39;]</span>
<span class="c1">#@markdown Finally, run this cell to set these values and plot a histogram of peak amplitudes.</span>

<span class="n">spike_detection_threshold</span> <span class="o">=</span> <span class="n">threshold</span>

<span class="k">if</span> <span class="n">peaks</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="n">peaks</span><span class="o">==</span><span class="s1">&#39;down&#39;</span><span class="p">:</span> <span class="n">polarity</span><span class="o">=-</span><span class="mi">1</span>

<span class="n">min_isi</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1">#seconds</span>

<span class="n">peaks</span><span class="p">,</span><span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">polarity</span> <span class="o">*</span> <span class="n">pre</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">spike_detection_threshold</span><span class="p">,</span> 
                         <span class="n">prominence</span> <span class="o">=</span> <span class="n">spike_detection_threshold</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">min_isi</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>
<span class="n">peaks_t</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">/</span><span class="n">fs</span>
<span class="n">inwin_inds</span> <span class="o">=</span> <span class="p">((</span><span class="n">peaks_t</span><span class="o">&gt;</span><span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">peaks_t</span><span class="o">&lt;</span><span class="n">stop_time</span><span class="p">))</span>
<span class="n">df_props</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;peak_heights&#39;</span><span class="p">][</span><span class="n">inwin_inds</span><span class="p">],</span>
        <span class="s1">&#39;spikeT&#39;</span> <span class="p">:</span> <span class="n">peaks_t</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">],</span>
        <span class="s1">&#39;spikeInd&#39;</span> <span class="p">:</span> <span class="n">peaks</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">]</span>
            <span class="p">})</span>

<span class="n">n</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="c1"># calculate the histogram</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">windur</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">winsamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
<span class="n">spkarray</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeInd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">spkarray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">winsamp</span> <span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="n">winsamp</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spkarray</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">df_norm</span> <span class="o">=</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="c1"># normalize for pca</span>

<span class="n">n_components</span><span class="o">=</span><span class="mi">5</span> <span class="c1">#df.shape[0] </span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_norm</span><span class="p">)</span>
<span class="n">df_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PC</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">)],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You detected </span><span class="si">%i</span><span class="s1"> events above threshold.&#39;</span> <span class="o">%</span><span class="k">len</span>(df.columns))

<span class="n">loadings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df_pca</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">loadings</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>

<span class="c1"># hfig,ax = plt.subplots(1)</span>
<span class="c1"># ax.set_xlabel(&#39;seconds&#39;)</span>
<span class="c1"># ax.set_ylabel(&#39;amplitude (a.u.)&#39;)</span>
<span class="c1"># ax.set_yticklabels([])</span>
<span class="c1"># for c in df_pca.columns[0:5]:</span>
<span class="c1">#     ax.plot(df_pca[c],label = c,alpha = 0.75)</span>
<span class="c1"># plt.legend(bbox_to_anchor=(1, 1));</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tasks completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p><a id = "cluster-events"></a></p>
<p>The histogram plot can give you a sense for how many distinct motor neurons might be in your recording.</p>
<p>We can cluster events based on peak height and waveform shape using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">“Kmeans”</a> clustering.
This will provide us with “putative single units” for further analysis.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Cluster Detected Events { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown Choose the number of clusters you want to split the event-based data into and type that number below. &lt;br&gt;</span>
<span class="c1">#@markdown &gt;Note: It can sometimes help to &quot;over-split&quot; the events into more clusters </span>
<span class="c1">#@markdown than you think will be necessary. You can try both strategies and assess the results.</span>
<span class="n">number_of_clusters</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="c1">#@markdown Then run this cell to run the Kmeans algorithm. </span>

<span class="c1"># No need to edit below this line</span>
<span class="c1">#################################</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">number_of_clusters</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
<span class="c1"># df_props[&#39;peaks_t&#39;] = peaks_t</span>
<span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
</div>
<p><a id = "display-clusters"></a></p>
<p>Now that the events are clustered, you can visualize the mean spike waveform associated with each cluster (putative motor neuron).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&#39;form&#39;}</span>

<span class="c1">#@markdown Run this cell to display the mean (and std) waveform for each cluster.</span>

<span class="n">windur</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">winsamps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">windur</span><span class="p">,</span><span class="n">windur</span><span class="p">,</span><span class="n">winsamps</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span>
<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Volts recorded&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;milliseconds&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]):</span>
    <span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#[&#39;peaks_t&#39;].values</span>
    <span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">windur</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">((</span><span class="n">pre</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">))]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; spikes in cluster number &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="n">spkwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">pre</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">winsamps</span><span class="p">):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt</span><span class="p">])</span>
    <span class="n">wav_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">wav_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">wav_u</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;cluster &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wav_u</span><span class="o">-</span><span class="n">wav_std</span><span class="p">,</span> <span class="n">wav_u</span><span class="o">+</span><span class="n">wav_std</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tasks completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p><a id='merge-clusters'></a>
If there are multiple spike clusters you want to merge into a single cell class, <em>edit and run</em> the cell below.</p>
<blockquote>
<div><p><strong>merge_cluster_list</strong> = a list of the clusters (identified by numbers associated with the colors specified in the legend above).</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>For example</strong>, the folowing list would merge clusters 0 and 2 together and 1, 4, and 3 together: <br>
<strong>merge_cluster_list = [[0,2],[1,4,3]]</strong></p></li>
<li><p>For each merge group, the first cluster number listed will be the re-asigned cluster number for that group (for example, in this case you would end up with a cluster number 0 and a cluster number 1).</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Merge Clusters { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown ONLY USE THIS CODE CELL IF YOU WANT TO MERGE CLUSTERS. </span>
<span class="c1">#@markdown OTHERWISE, MOVE ON. </span>
<span class="c1">#@markdown &lt;br&gt; Below, create your list (of sublists) of clusters to merge.</span>
<span class="c1">#@markdown &gt;Just leave out from the list any clusters that you want unmerged.</span>
<span class="n">merge_cluster_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="c1">#@param</span>
<span class="c1">#@markdown Then, run this cell to merge clusters as specified.</span>

<span class="k">for</span> <span class="n">k_group</span> <span class="ow">in</span> <span class="n">merge_cluster_list</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_group</span><span class="p">:</span>
        <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;you now have the following clusters: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tasks completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p>After merging, return to the <a class="reference external" href="#display-clusters">display clusters</a> code cell to plot the mean waveform of each new cluster (and determine if you need to <a class="reference external" href="#merge-clusters">merge more</a>).</p>
<p><a id="raw-cluster-scatter"></a></p>
<p>Once you are happy with the clustering results based on the waveform shapes, check back with the raw data.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Run this cell to overlay spike times by cluster identity on the raw signal</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pre synaptic&#39;</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">stop</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">inwin_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="n">stop</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">df_</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">]</span>
    <span class="n">df_</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">]</span>
    
    <span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">polarity</span><span class="o">*</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
                             <span class="n">line_color</span><span class="o">=</span><span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; times&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">))</span>
    
<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
               <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;time(seconds)&quot;</span><span class="p">,</span> 
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;amplitude (volts)&#39;</span><span class="p">)</span>


<span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">step</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">slider</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;800px&#39;</span>

<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">starti</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">stopi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">])):</span>
            <span class="n">inwin_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">df_</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">]</span>
            <span class="n">df_</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">polarity</span><span class="o">*</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">slider</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
<p>If you think that two different spike waveforms are being lumped together, try going back to the <a class="reference external" href="#cluster-events">Kmeans clustering algorithm</a> and increasing the cluster number constraint on the Kmeans algorithm - then <a class="reference external" href="#merge-clusters">merge</a> as needed.</p>
<p><a id="two"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part-ii-spike-triggered-voltage">
<h1>Part II. Spike-triggered voltage<a class="headerlink" href="#part-ii-spike-triggered-voltage" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<p>You can use the event times (spike times) to extract the pre-synaptic and/or post-synaptic voltage signal following each event. This is a helpful way to determine if you have recorded any synaptic pairs (a connected pair of pre and post-synaptic cells).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Type in the window duration that you want to analyze following each spiking event. </span>
<span class="c1">#@markdown Then run this cell to plot the average spike-triggered post-synaptic potential for each cluster</span>

<span class="n">window</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#@param</span>

<span class="c1"># No need to edit below this line</span>
<span class="c1">#################################</span>
<span class="n">windur</span> <span class="o">=</span> <span class="n">window</span>
<span class="n">winsamps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">windur</span><span class="p">,</span><span class="n">winsamps</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span> <span class="c1">#transform time to milliseconds</span>
<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;volts recorded&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;milliseconds&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]):</span>
    <span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">))]</span>
    <span class="n">synwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">post</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">sampling_rate</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">sampling_rate</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt</span><span class="p">])</span>
    <span class="n">wav_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">synwav</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">wav_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">synwav</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">wav_u</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;cluster &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="c1"># ax.fill_between(x, wav_u-wav_std, wav_u+wav_std, alpha = 0.25, color = pal[k])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>It is helpful to look at individual trials (events) to get a sense of the variance/reliability in the pre and post-synaptic signal associated with each spike time.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Type in the window duration that you want to analyze following each spiking event. </span>

<span class="n">window</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#@param</span>

<span class="c1">#@markdown Then, run this code cell to plot a random set of 10 spike time triggered voltage signals</span>
<span class="c1">#@markdown (pre and post synaptic) for each cluster (or maximum number of trials for that cluster).</span>
<span class="c1">#@markdown Every time you select a new cluster, a new random sample of trials from that cluster will be plotted.</span>
<span class="c1">#@markdown &lt;br&gt; The average waveform is plotted overlaid in black.</span>
<span class="n">windur</span> <span class="o">=</span> <span class="n">window</span>
<span class="n">winoffset</span> <span class="o">=</span> <span class="mf">0.002</span> <span class="c1"># in milliseconds</span>
<span class="n">winsamps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">xtime</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">windur</span><span class="p">,</span><span class="n">winsamps</span><span class="p">))</span><span class="o">-</span> <span class="n">winoffset</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span> <span class="c1">#subtract pre-spike offset</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#seed it to start</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">winoffset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">)]</span> <span class="o">-</span> <span class="n">winoffset</span>

<span class="n">spkt_</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">)]))]</span>
    
<span class="n">spkwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">pre</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="o">-</span> <span class="n">pre</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">spk_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spk_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spkwav</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xtime</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">line_color</span> <span class="o">=</span> <span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xtime</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">spk_u</span><span class="p">,</span><span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">synwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">post</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="o">-</span> <span class="n">post</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">syn_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">synwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">syn_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">synwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">synwav</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xtime</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">line_color</span> <span class="o">=</span> <span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xtime</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">syn_u</span><span class="p">,</span><span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    
<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">xaxis2_title</span><span class="o">=</span><span class="s2">&quot;time(milliseconds)&quot;</span><span class="p">,</span> 
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;amplitude (volts)&#39;</span><span class="p">,</span><span class="n">yaxis2_title</span><span class="o">=</span><span class="s1">&#39;amplitude (volts)&#39;</span><span class="p">)</span>

<span class="n">cluster_select</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]),</span>
    <span class="n">value</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Cluster ID:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">winoffset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">)]</span> <span class="o">-</span> <span class="n">winoffset</span>
        
        <span class="n">spkt_</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">)]))]</span>
    
        <span class="n">spkwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">pre</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="o">-</span> <span class="n">pre</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">spk_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">spk_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">synwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">post</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="o">-</span> <span class="n">post</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">syn_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">synwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">syn_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">synwav</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">trace_</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spkwav</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace_</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">trace_</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace_</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">spk_u</span>
        <span class="n">trace_</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">synwav</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace_</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">trace_</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace_</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">syn_u</span>
        <span class="n">trace_</span><span class="o">+=</span><span class="mi">1</span>


<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">cluster_select</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, you can plot the pre and post synaptic signal associated with each individual event time in each cluster. This visualization enables you to extract more exact quantitative measurements from the signals associated with each event.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title  {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Type in the window duration that you want to analyze following each spiking event. </span>

<span class="n">window</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#@param</span>

<span class="c1">#@markdown Then, run this code cell to plot individual spike-triggered voltage signals</span>
<span class="c1">#@markdown (pre and post synaptic) for each cluster. Select the cluster from the dropdown menu.</span>
<span class="c1">#@markdown Select the spike event number using the slider.</span>

<span class="n">windur</span><span class="o">=</span><span class="n">window</span>

<span class="n">winoffset</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># in milliseconds</span>
<span class="n">winsamps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">xtime</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">windur</span><span class="p">,</span><span class="n">winsamps</span><span class="p">))</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">-</span> <span class="n">winoffset</span> <span class="c1">#subtract pre-spike offset</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#seed it to start</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">winoffset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">)]</span> <span class="o">-</span> <span class="n">winoffset</span><span class="o">/</span><span class="mi">1000</span>

<span class="n">spkt_</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
<span class="n">spkwav</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="o">-</span> <span class="n">pre</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xtime</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">spkwav</span><span class="p">,</span><span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pre synaptic&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">synwav</span> <span class="o">=</span> <span class="n">post</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span><span class="c1"># - post[int(spkt_*fs)]</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xtime</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">synwav</span><span class="p">,</span><span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;post synaptic&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">xaxis2_title</span><span class="o">=</span><span class="s2">&quot;time(milliseconds)&quot;</span><span class="p">,</span> 
                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;pre-synaptic voltage&#39;</span><span class="p">,</span><span class="n">yaxis2_title</span><span class="o">=</span><span class="s1">&#39;post-synaptic voltage&#39;</span><span class="p">)</span>

<span class="n">cluster_select</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]),</span>
    <span class="n">value</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Cluster ID:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">event_select</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">),</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Spike Event Number:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">readout_format</span><span class="o">=</span><span class="s1">&#39;d&#39;</span>
<span class="p">)</span>
<span class="n">event_select</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;600px&#39;</span>

<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">winoffset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">)]</span> <span class="o">-</span> <span class="n">winoffset</span><span class="o">/</span><span class="mi">1000</span>
        
        <span class="n">event_select</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

        <span class="n">spkt_</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[</span><span class="n">event_select</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="c1"># shoulod be able to use &quot;t&quot;</span>
        <span class="n">spkwav</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="o">-</span> <span class="n">pre</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)]</span>
        <span class="n">synwav</span> <span class="o">=</span> <span class="n">post</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)):(</span><span class="nb">int</span><span class="p">(</span><span class="n">spkt_</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span><span class="c1"># - post[int(spkt_*fs)]</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">spkwav</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">synwav</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis1_range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pre</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pre</span><span class="p">)])</span>


<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">cluster_select</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">event_select</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
<p><a id="three"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part-iii-psp-amplitudes">
<h1>Part III. PSP amplitudes<a class="headerlink" href="#part-iii-psp-amplitudes" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<p>To detect post-synaptic potentials (psps), you can use the same method you used to find events (signal peaks) in the pre-synaptic signal. Did you record distinct classes of PSPs or was the distribution of PSPs continuous?</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&#39;form&#39;}</span>

<span class="c1">#@markdown Type in an appropriate event threshold amplitude for detection of psps.</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>

<span class="c1">#@markdown Then, run this cell to detect psp peaks and calculate their height.</span>

<span class="c1">#@markdown You will see a scatter plot of peaks (red) and bases (green) overlaid on the raw trace</span>
<span class="c1">#@markdown and a histogram of event peak amplitudes.</span>

<span class="n">min_isi</span> <span class="o">=</span> <span class="mf">0.002</span> <span class="c1">#seconds</span>

<span class="c1"># samples_inwin = samples[int(start_time/sample_rate):int(stop_time/sample_rate)]</span>
<span class="n">peaks</span><span class="p">,</span><span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">post</span><span class="p">,</span><span class="n">prominence</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">min_isi</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>
<span class="n">peaks_</span><span class="p">,</span><span class="n">props_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">post</span><span class="p">,</span><span class="n">prominence</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">min_isi</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peaks_</span><span class="p">,</span><span class="n">post</span><span class="p">[</span><span class="n">peaks_</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">post</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">psp_amp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">peaks_</span><span class="p">[</span><span class="n">peaks_</span><span class="o">&lt;</span><span class="n">p</span><span class="p">])</span>
    <span class="n">psp_amp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">-</span><span class="n">post</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">n</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">psp_amp</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">psp_amp</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">jitter</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr> 
Written by Dr. Krista Perks for courses taught at Wesleyan University.<p><a id="setup"></a></p>
<p><a id="one"></a></p>
<p><a id="two"></a></p>
<p><a id="three"></a></p>
<p><a id="four"></a></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./modules/crayfish-synaptic-connectivity"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Dr. Krista Perks<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>
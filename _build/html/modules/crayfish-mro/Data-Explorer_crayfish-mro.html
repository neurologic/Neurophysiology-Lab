
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sensory Coding - MROs &#8212; Neurophysiology Lab</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Responses" href="Responses_crayfish-mro.html" />
    <link rel="prev" title="Lab Manual" href="Lab-Manual_crayfish-mro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/NeuronImage_CourseHeader.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Neurophysiology Lab</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to Neurophysiology Lab
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  General
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../syllabus.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../standards.html">
   Standards
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../howto/howto.html">
   How To Guides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Python-Introduction-Coding-Light.html">
     Introduction to Python Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Executable-Notebooks.html">
     Executable Notebooks (Data Explorers)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Response-Notebooks.html">
     Response Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/NiUSB-6211.html">
     Nidaq USB 6211
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../materials.html">
   Materials
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Weekly Chapters
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../passive-membrane-models/passive-membrane-models_landing.html">
   Week 1. Introduction to Passive Physiology Principles
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../passive-membrane-models/Lab-Manual_passive-membrane-models.html">
     Lab Manual and Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../passive-membrane-models/Responses_passive-membrane-models.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eod/eod_landing.html">
   Week 2. Electric Organ Discharge
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod/Lab-Manual_eod.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod/Data-Explorer_eod.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod/Responses_eod.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eod-stim/eod-stim_landing.html">
   Week 3. Experimental Design for Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod-stim/Lab-Manual_eod-stim.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod-stim/Data-Explorer_eod-stim.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eod-stim/Responses_eod-stim.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../earthworm-giant-fiber/earthworm-giant-fiber_landing.html">
   Week 4. Giant Fiber
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../earthworm-giant-fiber/Lab-Manual_earthworm-giant-fiber.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../earthworm-giant-fiber/Data-Explorer_earthworm-giant-fiber.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../earthworm-giant-fiber/Responses_earthworm-giant-fiber.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../computer-model/computer-model_landing.html">
   Week 5. Computer Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../computer-model/Lab-Manual_computer-model.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../computer-model/Data-Explorer_computer-model.html">
     Data Explorer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../computer-model/Responses_computer-model.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="crayfish-mro_landing.html">
   Week 6. Muscle Receptor Organ
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Lab-Manual_crayfish-mro.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Sensory Coding - MROs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Responses_crayfish-mro.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-erg/crayfish-erg_landing.html">
   Week 7. ElectroRetinoGram
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-erg/Lab-Manual_crayfish-erg.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-erg/Data-Explorer_crayfish-erg.html">
     Sensory Coding - ERG
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-erg/Responses_crayfish-erg.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-n3/crayfish-n3_landing.html">
   Week 8. Crayfish Motor Nerve 3
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-n3/Lab-Manual_crayfish-n3.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-n3/Data-Explorer_crayfish-n3.html">
     Motor Neuron Coding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-n3/Responses_crayfish-n3.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-superficial-flexor/crayfish-superficial-flexor_landing.html">
   Week 9. Crayfish Superficial Flexor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-superficial-flexor/Lab-Manual_crayfish-superficial-flexor.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-superficial-flexor/Data-Explorer_crayfish-superficial-flexor.html">
     Arthropod skeletal muscle compared to vertebrate skeletal muscle:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-superficial-flexor/Responses_crayfish-superficial-flexor.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-synaptic-connectivity/crayfish-synaptic-connectivity_landing.html">
   Week 10. Synaptic Connectivity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-synaptic-connectivity/Lab-Manual_crayfish-synaptic-connectivity.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-synaptic-connectivity/Data-Explorer_crayfish-synaptic-connectivity.html">
     Arthropod skeletal muscle compared to vertebrate skeletal muscle:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-synaptic-connectivity/Responses_crayfish-synaptic-connectivity.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../crayfish-cpg/crayfish-cpg_landing.html">
   Week 11. Neural Circuits
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-cpg/Lab-Manual_crayfish-cpg.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-cpg/Data-Explorer_crayfish-cpg.html">
     Neural Circuits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../crayfish-cpg/Responses_crayfish-cpg.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../human-emg/human-emg_landing.html">
   Week 12. Human Motor Neurons
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg/Lab-Manual_human-emg.html">
     Lab Manual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg/Data-Explorer_human-emg.html">
     Human Motor Neuron Coding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../human-emg/Responses_human-emg.html">
     Responses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../capstone_landing.html">
   Week 13. Capstone
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../capstone_assignment-guidelines.html">
     Capstone guidelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../howto/Data-Explorer_general.html">
     Data Explorer
     <em>
      general
     </em>
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Future Directions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../extensions/extensions.html">
   Extended materials
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/modules/crayfish-mro/Data-Explorer_crayfish-mro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/neurologic/Neurophysiology-Lab"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/neurologic/Neurophysiology-Lab/issues/new?title=Issue%20on%20page%20%2Fmodules/crayfish-mro/Data-Explorer_crayfish-mro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/neurologic/Neurophysiology-Lab/main?urlpath=tree/modules/crayfish-mro/Data-Explorer_crayfish-mro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/neurologic/Neurophysiology-Lab/blob/main/modules/crayfish-mro/Data-Explorer_crayfish-mro.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Sensory Coding - MROs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-i-process-data">
   Part I. Process Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select-data">
     1. Select Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detect-peaks">
     2. Detect Peaks
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster">
     3. Cluster
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#kmeans">
       Kmeans
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#visualize">
       Visualize
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#merge-clusters">
       Merge Clusters
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-event-categorization-against-raw-data">
       Check event categorization against raw data.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-ii-analyze-processed-data">
   Part II. Analyze Processed Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-continuous-isi">
     Plot continuous ISI
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-trial-rate-overlaid">
     Plot trial rate overlaid
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-an-exponential-model">
     Fitting an exponential model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-model-data">
     Generate model data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inspect-model-parameters-across-conditions">
     Inspect model parameters across conditions
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Sensory Coding - MROs</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Sensory Coding - MROs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-i-process-data">
   Part I. Process Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select-data">
     1. Select Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detect-peaks">
     2. Detect Peaks
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster">
     3. Cluster
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#kmeans">
       Kmeans
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#visualize">
       Visualize
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#merge-clusters">
       Merge Clusters
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-event-categorization-against-raw-data">
       Check event categorization against raw data.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-ii-analyze-processed-data">
   Part II. Analyze Processed Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-continuous-isi">
     Plot continuous ISI
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-trial-rate-overlaid">
     Plot trial rate overlaid
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-an-exponential-model">
     Fitting an exponential model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-model-data">
     Generate model data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inspect-model-parameters-across-conditions">
     Inspect model parameters across conditions
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a href="https://colab.research.google.com/github/neurologic/Neurophysiology-Lab/blob/main/week-5/Sensory-Coding-MRO.ipynb" target="_blank" rel="noopener noreferrer"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"/></a></p>
<p><a id="intro"></a></p>
<div class="tex2jax_ignore mathjax_ignore section" id="sensory-coding-mros">
<h1>Sensory Coding - MROs<a class="headerlink" href="#sensory-coding-mros" title="Permalink to this headline">¶</a></h1>
<p>There are two MROs innervating the deep flexor muscles, which can be distinguished based on spike height and shape.</p>
<p>What are the dynamic properties of MRO sensory responses? In this notebook, you will process, analyze, and model MRO sensory responses.</p>
<p><a id="toc"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="#intro">Introduction</a></p></li>
<li><p><a class="reference external" href="#setup">Setup</a></p></li>
<li><p><a class="reference external" href="#one">Part I. Process Data</a></p></li>
<li><p><a class="reference external" href="#two">Part II. Analyze Processed Data</a></p></li>
</ul>
<p><a id="setup"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<p>Import and define functions</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode: &quot;form&quot;}</span>

<span class="c1">#@markdown Run this code cell to import packages and define functions </span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span><span class="p">,</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">hilbert</span><span class="p">,</span><span class="n">medfilt</span><span class="p">,</span><span class="n">resample</span><span class="p">,</span> <span class="n">find_peaks</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">timezone</span><span class="p">,</span><span class="n">timedelta</span>
<span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">n_colors</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">pal</span> <span class="o">=</span> <span class="n">pal</span><span class="o">.</span><span class="n">as_hex</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">widgets</span><span class="p">,</span> <span class="n">interact</span>

<span class="k">def</span> <span class="nf">monoExp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p>Mount Google Drive</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode: &quot;form&quot;}</span>

<span class="c1">#@markdown Run this cell to mount your Google Drive.</span>

<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p>Import data digitized with <em>Nidaq USB6211</em> and recorded using <em>Bonsai-rx</em> as a <em>.bin</em> file</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode: &quot;form&quot;}</span>

<span class="c1">#@markdown Specify the file path </span>
<span class="c1">#@markdown to your recorded data on Drive (find the filepath in the colab file manager:</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;full filepath goes here&quot;</span>  <span class="c1">#@param </span>
<span class="c1"># filepath = &quot;/Users/kperks/mnt/OneDrive - wesleyan.edu/Teaching/Neurophysiology_FA22/data/20220609/MRO2022-06-09T12_59_19.bin&quot;</span>

<span class="c1">#@markdown Specify the sampling rate and number of channels recorded.</span>
<span class="n">sampling_rate</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>
<span class="n">number_channels</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>
<span class="n">channel_to_process</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#@param</span>

<span class="c1"># sampling_rate = 30000 #@param</span>
<span class="c1"># number_channels = 1 #@param</span>

<span class="n">downsample</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#@param</span>
<span class="n">newfs</span> <span class="o">=</span> <span class="mi">10000</span> <span class="c1">#@param</span>

<span class="c1">#@markdown After you have filled out all form fields, </span>
<span class="c1">#@markdown run this code cell to load the data. </span>

<span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

<span class="c1"># No need to edit below this line</span>
<span class="c1">#################################</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">number_channels</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="c1"># only do this offset adjustment for motor nerve recordings</span>

<span class="n">dur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">sampling_rate</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;duration of recording was </span><span class="si">%0.2f</span><span class="s1"> seconds&#39;</span> <span class="o">%</span><span class="k">dur</span>)

<span class="n">fs</span> <span class="o">=</span> <span class="n">sampling_rate</span>
<span class="k">if</span> <span class="n">downsample</span><span class="p">:</span>
    <span class="c1"># newfs = 2500 #downsample data</span>
    <span class="n">chunksize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampling_rate</span><span class="o">/</span><span class="n">newfs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">number_channels</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">chunksize</span><span class="p">,:]</span>
    <span class="k">if</span> <span class="n">number_channels</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">chunksize</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dur</span><span class="p">)</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dur</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">channel_to_process</span>
    <span class="n">channel_signal</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">channel</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">channel_signal</span> <span class="o">=</span> <span class="n">data</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Now be a bit patient while it plots.&#39;</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shared_xaxes</span><span class="o">=</span> <span class="kc">True</span><span class="p">))</span> <span class="c1">#,layout=go.Layout(height=500, width=800))</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">channel_signal</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span>
                             <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;time(seconds)&quot;</span><span class="p">,</span> 
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;voltage&#39;</span><span class="p">)</span>

<span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">step</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">slider</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;600px&#39;</span>

<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">starti</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">stopi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">channel_signal</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>

<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">slider</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
<p><a id="one"></a></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part-i-process-data">
<h1>Part I. Process Data<a class="headerlink" href="#part-i-process-data" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<p>Decide what portion of the raw data you want to analyze (maybe your data file contains multiple conditions, maybe there was some bad noise during part of your recording, or the nerve was lost before the end of the recording, or you accidentally forgot to stop the recording, etc…).</p>
<p>If you want to analyze spiking activity (calculating rate, for example), you could look through your raw data and write down each time you see a spike.</p>
<p>There are lots of computational tools for automating this process. Computers can also help you extract patterns from large amounts of data (for example different “classes” of spike waveform). In neuroscience research, the process of clustering spiking events based on their amplitude and waveform is termed the “spike sorting.”</p>
<p>For this dataset, you will proocess the data using the following sequence of steps:</p>
<ol>
<li><p><a class="reference external" href="#select-data">Select Data</a></p></li>
<li><p><a class="reference external" href="#detect-spikes">Detect Peaks</a></p></li>
<li><p><a class="reference external" href="#cluster-events">Cluster Events</a></p>
<p>a. <a class="reference external" href="#kmeans">Kmeans</a></p>
<p>b. <a class="reference external" href="#display-clusters">Visualize</a></p>
<p>c. <a class="reference external" href="#merge-clusters">Merge Clusters</a></p>
<p>d. <a class="reference external" href="#raw-cluster-scatter">Check putative unit identity in raw data</a></p>
</li>
</ol>
<p><a id='select-data'></a></p>
<div class="section" id="select-data">
<h2>1. Select Data<a class="headerlink" href="#select-data" title="Permalink to this headline">¶</a></h2>
<p>Specify the timerange for the data you want to analyze.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown Type in the start and stop time (in seconds) </span>
<span class="c1">#@markdown that specifies the section of your recording you want to focus on for analysis.</span>
<span class="n">start_time</span> <span class="o">=</span>   <span class="kc">None</span> <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="n">stop_time</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>

<span class="c1"># start_time =   0 #@param {type: &quot;number&quot;}</span>
<span class="c1"># stop_time = 153  #@param {type: &quot;number&quot;}</span>
</pre></div>
</div>
</div>
</div>
<p><a id='detect-spikes'></a></p>
</div>
<div class="section" id="detect-peaks">
<h2>2. Detect Peaks<a class="headerlink" href="#detect-peaks" title="Permalink to this headline">¶</a></h2>
<p>Detect peaks in the signal</p>
<p>First, in the code cell below, write a simple script that:</p>
<ul class="simple">
<li><p>calculates the standard deviation of voltage in the raw signal using the <code class="docutils literal notranslate"><span class="pre">np.std()</span></code> module to store the result as a variable called “<b>SD</b>”.</p></li>
<li><p>uses the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function to print the value stored in the variable <code class="docutils literal notranslate"><span class="pre">SD</span></code> as an output of the code cell.</p></li>
<li><p>calculates the value equal to 5 times the standard deviation and stores the result as a variable called “<b>threshold</b>”.</p></li>
<li><p>uses the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function to print the value stored in the variable <code class="docutils literal notranslate"><span class="pre">threshold</span></code> as an output of the code cell.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>Then use the result to determine a spike detection threshold used by the <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">peaks</span></code> algorithm in the following code cell</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">inwin_inds</span><span class="p">))</span>
<span class="n">inwin_inds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown Type in the threshold amplitude for event detection determined by your SD calculations.</span>
<span class="n">spike_detection_threshold</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="c1"># spike_detection_threshold = 0.1  #@param {type: &quot;number&quot;}</span>

<span class="c1">#@markdown Then from the dropdown, select a polarity (whether peaks are up or down)</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="s2">&quot;select peak direction&quot;</span>  <span class="c1">#@param [&#39;select peak direction&#39;,&#39;up&#39;, &#39;down&#39;]</span>
<span class="c1"># peaks = &quot;up&quot;  #@param [&#39;select peak direction&#39;,&#39;up&#39;, &#39;down&#39;]</span>

<span class="c1">#@markdown Finally, run this cell to set these values and plot a histogram of peak amplitudes.</span>


<span class="k">if</span> <span class="n">peaks</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">:</span> <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="n">peaks</span><span class="o">==</span><span class="s1">&#39;down&#39;</span><span class="p">:</span> <span class="n">polarity</span><span class="o">=-</span><span class="mi">1</span>

<span class="n">min_isi</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1">#seconds</span>

<span class="n">peaks</span><span class="p">,</span><span class="n">props</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">polarity</span> <span class="o">*</span> <span class="n">channel_signal</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">spike_detection_threshold</span><span class="p">,</span> 
                         <span class="n">prominence</span> <span class="o">=</span> <span class="n">spike_detection_threshold</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">min_isi</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span>
<span class="n">peaks_t</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">/</span><span class="n">fs</span>
<span class="n">inwin_inds</span> <span class="o">=</span> <span class="p">((</span><span class="n">peaks_t</span><span class="o">&gt;</span><span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">peaks_t</span><span class="o">&lt;</span><span class="n">stop_time</span><span class="p">))</span>
<span class="n">df_props</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;peak_heights&#39;</span><span class="p">][</span><span class="n">inwin_inds</span><span class="p">],</span>
        <span class="s1">&#39;spikeT&#39;</span> <span class="p">:</span> <span class="n">peaks_t</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">],</span>
        <span class="s1">&#39;spikeInd&#39;</span> <span class="p">:</span> <span class="n">peaks</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">],</span>
        <span class="s1">&#39;cluster&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">inwin_inds</span><span class="p">)</span>
            <span class="p">})</span>

<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">polarity</span><span class="o">*</span><span class="n">channel_signal</span><span class="p">)),</span><span class="mi">200</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">)</span> <span class="c1"># calculate the histogram</span>
<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">n</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">windur</span> <span class="o">=</span> <span class="mf">0.003</span>
<span class="n">winsamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
<span class="n">spkarray</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeInd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">spkarray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_signal</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">winsamp</span> <span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="n">winsamp</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spkarray</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">df_norm</span> <span class="o">=</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="c1"># normalize for pca</span>

<span class="n">n_components</span><span class="o">=</span><span class="mi">5</span> <span class="c1">#df.shape[0] </span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_norm</span><span class="p">)</span>
<span class="n">df_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PC</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">)],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You detected </span><span class="si">%i</span><span class="s1"> events above threshold.&#39;</span> <span class="o">%</span><span class="k">len</span>(df.columns))

<span class="n">loadings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df_pca</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">loadings</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>

<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;event time (sec)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;amplitude (volts)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">polarity</span><span class="o">*</span><span class="n">channel_signal</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">],</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tasks completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p><a id = "cluster-events"></a></p>
</div>
<div class="section" id="cluster">
<h2>3. Cluster<a class="headerlink" href="#cluster" title="Permalink to this headline">¶</a></h2>
<p>Cluster events if needed.</p>
<p>The histogram plot produced in the last step can give you a sense for how many distinct neurons might be in your recording. The scatter plot of peak amplitude across time can give you a sense for how stable the recording was. If you had good recording stability, you can cluster spike events categorically to analyze the activity of individual neurons independently.</p>
<p>If your recording is not stable, or is too noisy, then you may not be able to distinguish cell types. In this case, skip this clustering step. You will only have one cluster and its identity will be ‘0’.</p>
<p>Clustering steps:</p>
<ul class="simple">
<li><p><a class="reference external" href="#kmeans">Kmeans</a></p></li>
<li><p><a class="reference external" href="#display-clusters">Visualize</a></p></li>
<li><p><a class="reference external" href="#merge-clusters">Merge Clusters</a></p></li>
<li><p><a class="reference external" href="#raw-cluster-scatter">Check event categorization against raw data</a></p></li>
</ul>
<p><a id='kmeans'></a></p>
<div class="section" id="kmeans">
<h3>Kmeans<a class="headerlink" href="#kmeans" title="Permalink to this headline">¶</a></h3>
<p>We can cluster events based on peak height and waveform shape using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">“Kmeans”</a> clustering.
This will provide us with “putative single units” for further analysis.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown Choose the number of clusters you want to split the event-based data into and type that number below. &lt;br&gt;</span>
<span class="c1">#@markdown &gt;Note: It can sometimes help to &quot;over-split&quot; the events into more clusters </span>
<span class="c1">#@markdown than you think will be necessary. You can try both strategies and assess the results.</span>
<span class="n">number_of_clusters</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#@param</span>
<span class="c1"># number_of_clusters = 1</span>
<span class="c1">#@markdown Then run this cell to run the Kmeans algorithm. </span>

<span class="c1"># No need to edit below this line</span>
<span class="c1">#################################</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">number_of_clusters</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
<span class="c1"># df_props[&#39;peaks_t&#39;] = peaks_t</span>
<span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
</div>
<p><a id = "display-clusters"></a></p>
</div>
<div class="section" id="visualize">
<h3>Visualize<a class="headerlink" href="#visualize" title="Permalink to this headline">¶</a></h3>
<p>Now that the events are clustered, you can visualize the mean spike waveform associated with each cluster (putative motor neuron).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&#39;form&#39;}</span>

<span class="c1">#@markdown Run this cell to display the mean (and std) waveform for each cluster.</span>

<span class="c1">#@markdown Specify the time before and after each event peak to plot.</span>
<span class="n">windur</span> <span class="o">=</span> <span class="mf">0.003</span> <span class="c1">#@param</span>

<span class="n">winsamps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">windur</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">windur</span><span class="p">,</span><span class="n">windur</span><span class="p">,</span><span class="n">winsamps</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span>
<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Volts recorded&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;milliseconds&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]):</span>
    <span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1">#[&#39;peaks_t&#39;].values</span>
    <span class="n">spkt</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">windur</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">channel_signal</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">windur</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spkt</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; spikes in cluster number &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="n">spkwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">channel_signal</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="n">winsamps</span><span class="p">):(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span><span class="o">+</span><span class="n">winsamps</span><span class="p">)]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">spkt</span><span class="p">])</span>
    <span class="n">wav_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">wav_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spkwav</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">wav_u</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;cluster &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wav_u</span><span class="o">-</span><span class="n">wav_std</span><span class="p">,</span> <span class="n">wav_u</span><span class="o">+</span><span class="n">wav_std</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tasks completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p><a id='merge-clusters'></a></p>
</div>
<div class="section" id="merge-clusters">
<h3>Merge Clusters<a class="headerlink" href="#merge-clusters" title="Permalink to this headline">¶</a></h3>
<p>You can skip this step if unecessary.
If there are multiple spike clusters you want to merge into a single cell class, <em>edit and run</em> the cell below.</p>
<blockquote>
<div><p><strong>merge_cluster_list</strong> = a list of the clusters (identified by numbers associated with the colors specified in the legend above).</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>For example</strong>, the folowing list would merge clusters 0 and 2 together and 1, 4, and 3 together: <br>
<strong>merge_cluster_list = [[0,2],[1,4,3]]</strong></p></li>
<li><p>For each merge group, the first cluster number listed will be the re-asigned cluster number for that group (for example, in this case you would end up with a cluster number 0 and a cluster number 1).</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title { display-mode: &quot;form&quot; }</span>

<span class="c1">#@markdown ONLY USE THIS CODE CELL IF YOU WANT TO MERGE CLUSTERS. </span>
<span class="c1">#@markdown OTHERWISE, MOVE ON. </span>
<span class="c1">#@markdown &lt;br&gt; Below, create your list (of sublists) of clusters to merge.</span>
<span class="c1">#@markdown &gt;Just leave out from the list any clusters that you want unmerged.</span>
<span class="n">merge_cluster_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="c1">#@param</span>
<span class="c1">#@markdown Then, run this cell to merge clusters as specified.</span>

<span class="k">for</span> <span class="n">k_group</span> <span class="ow">in</span> <span class="n">merge_cluster_list</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_group</span><span class="p">:</span>
        <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;you now have the following clusters: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tasks completed at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">(</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>
<p>After merging, return to the <a class="reference external" href="#display-clusters">display clusters</a> code cell to plot the mean waveform of each new cluster (and determine if you need to <a class="reference external" href="#merge-clusters">merge more</a>).</p>
<p><a id="raw-cluster-scatter"></a></p>
</div>
<div class="section" id="check-event-categorization-against-raw-data">
<h3>Check event categorization against raw data.<a class="headerlink" href="#check-event-categorization-against-raw-data" title="Permalink to this headline">¶</a></h3>
<p>Once you are happy with the clustering results based on the waveform shapes, check back with the raw data.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Run this cell to overlay spike times by cluster identity on the raw signal</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">channel_signal</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fs</span><span class="p">],</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pre synaptic&#39;</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">stop</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">inwin_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="n">stop</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">df_</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">]</span>
    <span class="n">df_</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">]</span>
    
    <span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">polarity</span><span class="o">*</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span>
                             <span class="n">line_color</span><span class="o">=</span><span class="n">pal</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; times&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">))</span>
    
<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
               <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;time(seconds)&quot;</span><span class="p">,</span> 
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;amplitude (volts)&#39;</span><span class="p">)</span>


<span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="n">dur</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">step</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">slider</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;800px&#39;</span>

<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">starti</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">stopi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">channel_signal</span><span class="p">[</span><span class="n">starti</span><span class="p">:</span><span class="n">stopi</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">])):</span>
            <span class="n">inwin_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">df_</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="n">inwin_inds</span><span class="p">]</span>
            <span class="n">df_</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">polarity</span><span class="o">*</span><span class="n">df_</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">slider</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
<p>If you think that two different spike waveforms are being lumped together, try going back to the <a class="reference external" href="#kmeans">Kmeans clustering algorithm</a> and increasing the cluster number constraint on the Kmeans algorithm - then <a class="reference external" href="#merge-clusters">merge</a> as needed.</p>
<p><a id="two"></a></p>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="part-ii-analyze-processed-data">
<h1>Part II. Analyze Processed Data<a class="headerlink" href="#part-ii-analyze-processed-data" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="#toc">toc</a></p>
<p>This section provides tools to obtain two metrics of MRO spiking responses: <em><strong>spike rate</strong></em> and <em><strong>spike rate adaptation</strong></em>.</p>
<p>First, you will plot the inter-spike interval (ISI; the time between spikes) for the event cluster that you want to analyze. You will also obtain a plot of the stimulus signal aligned in time to the spiking data.</p>
<p>From this plot, you should be able to determine ‘trial’ times for a trial-based analysis of spike rate and adaptation.</p>
<div class="section" id="plot-continuous-isi">
<h2>Plot continuous ISI<a class="headerlink" href="#plot-continuous-isi" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Run this code cell to plot:  </span>
<span class="c1">#@markdown - a scatter of ISI across time for individual clusters  </span>
<span class="c1">#@markdown - the stimulus signal</span>
<span class="c1">#@markdown &gt; Once you run this code cell a first time, you will be able to select different clusters from the dropdown menu to change the plot data accordingly.</span>


<span class="n">k</span> <span class="o">=</span> <span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#seed it to start</span>
<span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">isi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">spkt</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">isi</span><span class="p">,</span> <span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;isi (seconds)&quot;</span><span class="p">,</span>
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;isi (seconds)&#39;</span><span class="p">)</span>

<span class="n">cluster_select</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]),</span>
    <span class="n">value</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Cluster ID:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c1"># our function that will modify the xaxis range</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
        <span class="n">spkt</span> <span class="o">=</span> <span class="n">df_props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_props</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;spikeT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">isi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">spkt</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">isi</span>


<span class="n">vb</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">interactive</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">cluster_select</span><span class="p">)))</span>
<span class="n">vb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_items</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
<span class="n">vb</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-trial-rate-overlaid">
<h2>Plot trial rate overlaid<a class="headerlink" href="#plot-trial-rate-overlaid" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Determine the start time for each *trial*.  </span>
<span class="c1">#@markdown What defines the start of a trial will depend on your question.  </span>
<span class="c1">#@markdown Enter the trial times as a list below.</span>

<span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">51.72</span><span class="p">,</span> <span class="mf">61.65</span><span class="p">,</span> <span class="mf">71.256</span><span class="p">,</span> <span class="mf">83.063</span><span class="p">]</span> <span class="c1">#@param</span>

<span class="c1"># # different amplitudes</span>
<span class="c1"># trials = [6.345,13.836,21.63,32.635,40.319]</span>
<span class="c1"># trials = [51.72, 61.65, 71.256, 80.063]</span>
<span class="c1"># trials = [94.692,103.73,111.665,120.871,129.286]</span>

<span class="c1"># # offset response</span>
<span class="c1"># trials = [99.832,110,118.327,126.86]</span>

<span class="c1">#@markdown How much time before and after the trial time do you want to visualize?</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1">#@markdown Run this code cell to plot the result (for the cluster you selected in the first code cell of this section)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trials_list</span><span class="p">:</span>
    <span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spkt</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
    <span class="n">sweep</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="p">)]</span><span class="o">-</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span>
    <span class="n">sweep_rate</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">sweep_rate</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;time (seconds)&quot;</span><span class="p">,</span>
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;rate&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fitting-an-exponential-model">
<h2>Fitting an exponential model<a class="headerlink" href="#fitting-an-exponential-model" title="Permalink to this headline">¶</a></h2>
<p>You can create a <em><strong>model</strong></em> of the MRO response. If the model is correct, you should be able to ‘explain’ the response in terms of the model (it should be able to predict all features of the response).</p>
<p>The following code cells provide a tool to model the response using a single exponential function of the form:</p>
<div class="math notranslate nohighlight">
\[
\Large y = a + b*e^{-x/\tau}
\]</div>
<p>For spiking adaptation, the following equation variables are more intuitive:</p>
<div class="math notranslate nohighlight">
\[
\Large R_{t} = R_{\infty} + R_{0}e^{−t/\tau}
\]</div>
<p>Where <span class="math notranslate nohighlight">\(R_{t}\)</span> is the firing rate at time <span class="math notranslate nohighlight">\(t\)</span>, <span class="math notranslate nohighlight">\(R_{\infty}\)</span> is the calculated firing rate if this degree of stretch were maintained infinitely, <span class="math notranslate nohighlight">\(R_{\infty}\)</span> + <span class="math notranslate nohighlight">\(R_{0}\)</span> is the calculated “initial” peak firing rate at time 0, and <span class="math notranslate nohighlight">\(\tau\)</span> is the adaptation rate. The adaptation rate is the time it takes the spike rate to fall by a factor of <span class="math notranslate nohighlight">\(1/e\)</span>.</p>
<p>To model the MRO response in this form, you will <em>fit</em> your data to the model.</p>
<p>In biology / electrophysiology <em>bi</em>exponential functions are often used to separate fast and slow components of exponential decay which may be caused by different mechanisms and occur at different rates. In this example we will only fit the data to a method with a exponential component (a <em>mono</em>exponential function), but the idea is the same.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Fitting the model on a single trial</span>

<span class="c1">#@markdown Specify a single trial time (t), </span>
<span class="c1">#@markdown the duration of the trial (trial_dur; after trial onset), </span>
<span class="c1">#@markdown and initial estimates for the model parameters (parameter_initialize).</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">83.063</span> <span class="c1">#@param</span>
<span class="n">trial_dur</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#@param</span>
<span class="n">parameter_initialize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">#@param # start with values near those we expect</span>

<span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spkt</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;=</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span><span class="o">+</span><span class="n">trial_dur</span><span class="p">)]</span><span class="o">-</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># perform the fit</span>
<span class="n">params_</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">monoExp</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">parameter_initialize</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">params_</span>

<span class="c1"># determine quality of the fit</span>
<span class="n">squaredDiffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ys</span> <span class="o">-</span> <span class="n">monoExp</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="n">squaredDiffsFromMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ys</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
<span class="n">rSquared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">squaredDiffs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">squaredDiffsFromMean</span><span class="p">)</span>

<span class="c1"># inspect the parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;What are the model parameters?&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y = </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> * e^(-x / </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) + </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># report the fit</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;How good is the model fit to your data?&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² = </span><span class="si">{</span><span class="n">rSquared</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ys</span><span class="p">,</span> <span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">monoExp</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">line_color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span> <span class="s1">&#39;fit&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;time (seconds)&quot;</span><span class="p">,</span>
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;rate&#39;</span><span class="p">)</span>

<span class="c1"># # plot the results</span>
<span class="c1"># plt.plot(xs, ys, &#39;.&#39;, label=&quot;data&quot;)</span>
<span class="c1"># plt.plot(xs, monoExp(xs, m, t, b), &#39;--&#39;, label=&quot;fitted&quot;)</span>
<span class="c1"># plt.title(&quot;Fitted Exponential Curve&quot;)</span>
</pre></div>
</div>
</div>
</div>
<p>There is likely <em>across trial</em> variability in the MRO response. You can get a model fit for each trial and then evaluate the distrubution of model parameters. Alternatively, you could take the average response across trials and fit the model to the average. Here, you will do the former. What are the pros and cons of each of these methods in terms of statistical results? In other words, are the two methods equivalent or can you calculate different metrics of statistics depending on the method?</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Fitting the model across multiple trials</span>

<span class="c1">#@markdown Specify a list of trials times, the duration of the trial (after trial onset), and estimates for the model parameters.</span>
<span class="n">trial_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">94.692</span><span class="p">,</span><span class="mf">103.73</span><span class="p">,</span><span class="mf">111.665</span><span class="p">,</span><span class="mf">120.871</span><span class="p">,</span><span class="mf">129.286</span><span class="p">]</span> <span class="c1">#@param </span>
<span class="n">trial_dur</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#@param</span>
<span class="n">parameter_initialize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">#@param # start with values near those we expect</span>

<span class="c1"># plt.figure()</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trial_list</span><span class="p">:</span>
    <span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spkt</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">spkt</span><span class="p">[(</span><span class="n">spkt</span><span class="o">&gt;=</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spkt</span><span class="o">&lt;</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span><span class="o">+</span><span class="n">trial_dur</span><span class="p">)]</span><span class="o">-</span><span class="n">spkt</span><span class="p">[</span><span class="n">ti</span><span class="p">]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    
    <span class="n">params_</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">monoExp</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">parameter_initialize</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">params_</span>
    
    <span class="n">squaredDiffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ys</span> <span class="o">-</span> <span class="n">monoExp</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">squaredDiffsFromMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ys</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
    <span class="n">rSquared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">squaredDiffs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">squaredDiffsFromMean</span><span class="p">)</span>
    <span class="n">params_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">params_</span><span class="p">,</span> <span class="p">[</span><span class="n">rSquared</span><span class="p">]])</span>
    
    <span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">params_</span><span class="p">)</span>

<span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="n">u_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fit_parameters</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">std_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">fit_parameters</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># inspect the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;results based on mean across trials:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² = </span><span class="si">{</span><span class="n">u_fit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y = </span><span class="si">{</span><span class="n">u_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2"> * e^(-x / </span><span class="si">{</span><span class="n">u_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">) + </span><span class="si">{</span><span class="n">u_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;array of fit parameters across all trials: (R0, tau, Rinf, R2)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit_parameters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean fit parameters: (R0, tau, Rinf, R2)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">u_fit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;standard deviation fit parameters: (R0, tau, Rinf, R2)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">std_fit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="generate-model-data">
<h2>Generate model data<a class="headerlink" href="#generate-model-data" title="Permalink to this headline">¶</a></h2>
<p>Now, use the mean parameters to plot the model equations.
For multiple conditions, list multiple values for each parameter. Keep the order of conditions the same in each list.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Create a list of conditions</span>
<span class="n">condition</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="c1">#@markdown Create a list of parameters across conditions</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mf">7.7</span><span class="p">,</span> <span class="mf">7.36</span><span class="p">,</span> <span class="mf">7.05</span><span class="p">]</span> <span class="c1">#@param</span>
<span class="n">tau</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">]</span> <span class="c1">#@param</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.54</span><span class="p">,</span> <span class="mf">13.63</span><span class="p">,</span> <span class="mf">14.88</span><span class="p">]</span> <span class="c1">#@param</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">]</span><span class="c1">#@param</span>

<span class="c1">#@markdown How long do you want the model MRO to be stretched for under each condition?</span>
<span class="n">trial_dur</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#@param</span>

<span class="c1"># Run this code cell to plot the model across conditions</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">(</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">trial_dur</span><span class="p">,</span><span class="n">trial_dur</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="k">for</span> <span class="n">m_</span><span class="p">,</span><span class="n">tau_</span><span class="p">,</span><span class="n">b_</span><span class="p">,</span><span class="n">c_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">tau</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">condition</span><span class="p">):</span>
    <span class="n">y_</span> <span class="o">=</span> <span class="n">monoExp</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">m_</span><span class="p">,</span><span class="n">tau_</span><span class="p">,</span><span class="n">b_</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">c_</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">),</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;time (seconds)&quot;</span><span class="p">,</span>
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;rate&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="inspect-model-parameters-across-conditions">
<h2>Inspect model parameters across conditions<a class="headerlink" href="#inspect-model-parameters-across-conditions" title="Permalink to this headline">¶</a></h2>
<p>Plot the model parameters as a function of stretch. Is there some predictable relationship between these?
Which parameters are a function of specific stretch amplitudes? Which parameters are independent of the specific stretch amplitude? In other words, which properties of the MRO response code for position of the tail and which code for other aspects of the movement?</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title {display-mode:&quot;form&quot;}</span>

<span class="c1">#@markdown Run this code cell to plot parameters across conditions. </span>

<span class="n">hfig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="n">r_squared</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr> 
Written by Dr. Krista Perks for courses taught at Wesleyan University.<p><a id="setup"></a></p>
<p><a id="one"></a></p>
<p><a id="two"></a></p>
<p><a id="three"></a></p>
<p><a id="four"></a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./modules/crayfish-mro"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="Lab-Manual_crayfish-mro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Lab Manual</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Responses_crayfish-mro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Responses</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Dr. Krista Perks<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>